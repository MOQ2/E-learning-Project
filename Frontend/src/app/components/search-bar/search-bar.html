<div class="search-trigger" *ngIf="!isOpen">
  <button class="search-trigger-btn" type="button" (click)="openSearch()">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    Search
  </button>
</div>

<div class="search-container" *ngIf="isOpen" (click)="closeSearch()">
  <div class="search-box" (click)="$event.stopPropagation()">
    <div class="search-header">
      <input
        type="text"
        placeholder="Search courses, instructors..."
        [(ngModel)]="searchQuery"
        (input)="onSearchInput($event)"
        class="search-input"
        autocomplete="off"
      />
      <button class="esc-btn" type="button" (click)="closeSearch()">Esc</button>
    </div>

    <div class="search-content">
      <div class="results">
        <ng-container *ngIf="searchQuery.trim().length > 0; else startTyping">
          <div class="loading-state" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>Searching...</p>
          </div>

          <ng-container *ngIf="!isLoading && searchResults.length > 0">
            <div
              class="result-card"
              *ngFor="let course of searchResults; let i = index"
              [class.selected]="i === selectedIndex"
              (click)="navigateToCourse(course.id)"
            >
              <img
                [src]="course.thumbnailUrl || '/mortarboard_1940690.png'"
                [alt]="course.name"
                class="thumbnail"
              />
              <div class="info">
                <h3>{{ course.name }}</h3>
                <p>{{ getCourseSubtitle(course) }}</p>
              </div>
              <button
                class="action-btn"
                type="button"
                (click)="navigateToCourse(course.id); $event.stopPropagation()"
              >
                {{ getActionLabel() }}
              </button>
            </div>
          </ng-container>

          <div class="empty-state" *ngIf="!isLoading && searchResults.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <p>No results for "{{ searchQuery }}"</p>
            <span>Try different keywords or browse our catalog</span>
          </div>
        </ng-container>

        <ng-template #startTyping>
          <div class="empty-state initial">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            <p>Start typing to discover courses and instructors</p>
            <span>Try keywords like "React beginner", "Priya", or "data viz"</span>
          </div>
        </ng-template>
      </div>

      <div class="filters">
        <h4>Quick filters</h4>
        <button
          class="filter-btn"
          type="button"
          *ngFor="let filter of quickFilters"
          [class.active]="filter.value === activeFilter"
          [attr.aria-pressed]="filter.value === activeFilter"
          (click)="setFilter(filter.value); $event.stopPropagation()"
        >
          {{ filter.label }}
        </button>
      </div>
    </div>

    <div class="footer">
      <span><kbd>Enter</kbd> to open</span>
      <span><kbd>Tab</kbd> to navigate</span>
      <span class="hint">Use keywords like "React beginner", "Priya", "data viz"</span>
    </div>
  </div>
</div>
