<div class="page-wrapper">
  <app-nav-bar></app-nav-bar>

  <!-- Overview Page Layout -->
  <ng-container *ngIf="activePage === 'overview'">
    <main class="course-editor">
      <app-sidebar [activeLink]="activePage" [courseCreated]="courseCreated" (activeLinkChange)="onActiveLinkChange($event)"></app-sidebar>

      <div class="content-panel">
        <header class="content-header">
          <h1>
            <img src="assets/images/vector-69.svg" alt="" /> Course Overview
          </h1>
        </header>

        <div *ngIf="isLoadingCourse" class="loading-overlay">
          <p>Loading course...</p>
        </div>

        <app-course-form *ngIf="!isLoadingCourse"
          [course]="currentCourseOverview"
          (formChange)="handleFormChange($event)"
          (fileSelected)="onFileSelected($event)">
        </app-course-form>

        <footer class="content-footer">
          <div class="content-footer__actions">
            <button type="button" class="button button--primary" (click)="onContinue()" [disabled]="isSavingCourse || isUploadingFile">
              <span *ngIf="isUploadingFile">Uploading...</span>
              <span *ngIf="!isUploadingFile && isSavingCourse">Saving...</span>
              <span *ngIf="!isUploadingFile && !isSavingCourse">Continue</span>
            </button>
          </div>
        </footer>
      </div>
    </main>
  </ng-container>

  <!-- Modules Page Layout -->
  <ng-container *ngIf="activePage === 'modules'">
    <main class="course-creation-page">
      <aside class="course-sidebar">
        <app-sidebar [activeLink]="activePage" [courseCreated]="courseCreated" (activeLinkChange)="onActiveLinkChange($event)"></app-sidebar>
        <!-- Modules list rendered by the reusable ModulesListComponent -->
        <app-modules-list
          [modules]="modules"
          [selectedModule]="currentModule"
          (moduleSelected)="onModuleSelected($event)"
          (addModule)="onAddModule()"
          (modulesReordered)="onModulesReordered($event)">
        </app-modules-list>
      </aside>

      <div class="editor-content">
        <section class="editor-card">
          <header class="editor-header">
            <div class="editor-header__title">
              <h2>Modules • Editor</h2>
            </div>
            <div class="editor-header__status">
              <span>Module status</span>
              <span class="tag tag--green">Active</span>
            </div>
          </header>

          <div class="editor-body">
            <div *ngIf="isLoadingModule" class="loading-overlay">
              <p>Loading module details...</p>
            </div>
            <app-module-form *ngIf="!isLoadingModule" [module]="currentModule" (saveDraft)="onSaveModuleDraft($event)" (addLesson)="onAddLesson()" (editLesson)="onEditLesson($event)" (deleteLesson)="onDeleteLesson($event)" (lessonOrderChanged)="onLessonOrderChanged($event)"></app-module-form>
          </div>

          <footer class="editor-footer">
            <button class="btn btn--secondary" (click)="onActiveLinkChange('overview')">Back to Overview</button>
            <button class="btn btn--primary-light">Go to Lessons</button>
            <button class="btn btn--primary" (click)="onActiveLinkChange('publish')">Continue to Review</button>
          </footer>
        </section>
      </div>
    </main>
  </ng-container>

  <!-- Lesson Page Layout -->
  <ng-container *ngIf="activePage === 'lesson'">
    <main class="course-creation-page">
      <aside class="course-sidebar">
        <app-sidebar [activeLink]="activePage" [courseCreated]="courseCreated" (activeLinkChange)="onActiveLinkChange($event)"></app-sidebar>
      </aside>

      <div class="editor-content">
        <section class="editor-card">
          <header class="editor-header">
            <div class="editor-header__title">
              <h2>Lesson • Editor</h2>
            </div>
            <div class="editor-header__status">
              <span>Lesson status</span>
              <span class="tag tag--green">Active</span>
            </div>
            <div class="editor-header__actions">
              <button class="btn btn--secondary" (click)="lessonEditor.onSaveDraftClick()">Save draft</button>
              <button class="btn btn--primary" (click)="lessonEditor.onPreviewClick()">Preview</button>
            </div>
          </header>

          <div class="editor-body">
            <div *ngIf="isUploadingFile || isSavingLesson" class="loading-overlay">
              <p *ngIf="isUploadingFile">Uploading files...</p>
              <p *ngIf="isSavingLesson">Saving lesson...</p>
            </div>
            <app-lesson-editor [lesson]="currentLesson" (saveLesson)="onSaveLesson($event)" (saveDraft)="onSaveDraftLesson($event)" (preview)="onPreviewLesson($event)" (goBack)="onGoBackFromLesson()" (deleteAttachment)="onDeleteAttachment($event)"></app-lesson-editor>
          </div>

          <footer class="editor-footer">
            <button class="btn btn--secondary" (click)="onGoBackFromLesson()" [disabled]="isSavingLesson || isUploadingFile">Back to Modules</button>
            <button class="btn btn--primary" (click)="lessonEditor.onFormSubmit()" [disabled]="isSavingLesson || isUploadingFile">
              <span *ngIf="isSavingLesson || isUploadingFile">Saving...</span>
              <span *ngIf="!isSavingLesson && !isUploadingFile">Save & Continue</span>
            </button>
          </footer>
        </section>
      </div>
    </main>
  </ng-container>

  <!-- Publish Page -->
  <ng-container *ngIf="activePage === 'publish'">
    <main class="course-editor">
      <app-sidebar [activeLink]="activePage" [courseCreated]="courseCreated" (activeLinkChange)="onActiveLinkChange($event)"></app-sidebar>
      <div class="content-panel">
        <header class="content-header">
          <h1>Review & Publish</h1>
        </header>
        <div class="content-body">
          <p>Review & Publish content here</p>
        </div>
      </div>
    </main>
  </ng-container>

</div>
