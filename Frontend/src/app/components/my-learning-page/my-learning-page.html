<div class="my-learning-container">
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your learning dashboard...</p>
  </div>

  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">‚ùå</div>
    <h2>Oops! Something went wrong</h2>
    <p>{{ error }}</p>
    <button (click)="loadDashboard()" class="retry-button">Try Again</button>
  </div>

  <div *ngIf="!loading && !error" class="main-content">
    <div class="content-wrapper">
      <header class="page-header">
        <div class="page-hero">
          <div class="page-hero-badge">My Dashboard</div>
          <h1 class="page-title">My Learning</h1>
          <p class="page-subtitle">
            Continue where you left off, pick new lessons, and track your progress across courses.
          </p>
        </div>
        <div class="page-hero-illustration" aria-hidden="true"></div>
      </header>

      <section class="summary-section" *ngIf="stats">
        <article class="summary-card">
          <div class="summary-icon enrolled">üìö</div>
          <div class="summary-meta">
            <p class="summary-label">Total Enrolled</p>
            <p class="summary-value">{{ stats.totalEnrolledCourses || 0 }}</p>
          </div>
        </article>
        <article class="summary-card">
          <div class="summary-icon active">üéØ</div>
          <div class="summary-meta">
            <p class="summary-label">Active Courses</p>
            <p class="summary-value">{{ stats.activeCourses || 0 }}</p>
          </div>
        </article>
        <article class="summary-card">
          <div class="summary-icon completed">üèÅ</div>
          <div class="summary-meta">
            <p class="summary-label">Completed</p>
            <p class="summary-value">{{ stats.completedCourses || 0 }}</p>
          </div>
        </article>
        <article class="summary-card">
          <div class="summary-icon progress">üìä</div>
          <div class="summary-meta">
            <p class="summary-label">Avg. Progress</p>
            <p class="summary-value">{{ stats.averageProgressPercentage || 0 }}%</p>
          </div>
        </article>
      </section>

      <div class="dashboard-grid">
        <section class="primary-column">
          <div class="status-card">
            <div class="status-filters">
              <button
                type="button"
                class="status-pill"
                [class.active]="filterStatus === 'active'"
                (click)="filterStatus = 'active'"
              >
                In Progress
              </button>
              <button
                type="button"
                class="status-pill"
                [class.active]="filterStatus === 'completed'"
                (click)="filterStatus = 'completed'"
              >
                Completed
              </button>
              <button
                type="button"
                class="status-pill"
                [class.active]="filterStatus === 'all'"
                (click)="filterStatus = 'all'"
              >
                All Courses
              </button>
            </div>
          </div>

          <div class="action-toolbar">
            <div class="search-wrapper">
              <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
              <input
                type="text"
                class="search-input"
                placeholder="Search your courses"
                [(ngModel)]="searchQuery"
                (input)="onSearchChange()"
              />
            </div>

            <div class="toolbar-actions">
              <div class="filter-dropdown">
                <button type="button" class="toolbar-button" (click)="toggleFilterMenu()">
                  <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                    ></path>
                  </svg>
                  Filter
                </button>
                <div class="filter-menu" *ngIf="showFilterMenu">
                  <button
                    type="button"
                    class="filter-option"
                    [class.active]="filterStatus === 'active'"
                    (click)="filterStatus = 'active'; showFilterMenu = false"
                  >
                    In Progress
                  </button>
                  <button
                    type="button"
                    class="filter-option"
                    [class.active]="filterStatus === 'completed'"
                    (click)="filterStatus = 'completed'; showFilterMenu = false"
                  >
                    Completed
                  </button>
                  <button
                    type="button"
                    class="filter-option"
                    [class.active]="filterStatus === 'all'"
                    (click)="filterStatus = 'all'; showFilterMenu = false"
                  >
                    All Courses
                  </button>
                </div>
              </div>

              <div class="sort-dropdown">
                <button type="button" class="toolbar-button" (click)="toggleSortMenu()">
                  <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                    ></path>
                  </svg>
                  Sort: {{ getSortLabel() }}
                  <svg class="dropdown-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div class="sort-menu" *ngIf="showSortMenu">
                  <button
                    type="button"
                    class="sort-option"
                    [class.active]="sortBy === 'recent'"
                    (click)="sortBy = 'recent'; showSortMenu = false"
                  >
                    Most Recent
                  </button>
                  <button
                    type="button"
                    class="sort-option"
                    [class.active]="sortBy === 'progress'"
                    (click)="sortBy = 'progress'; showSortMenu = false"
                  >
                    Progress
                  </button>
                  <button
                    type="button"
                    class="sort-option"
                    [class.active]="sortBy === 'name'"
                    (click)="sortBy = 'name'; showSortMenu = false"
                  >
                    Name (A-Z)
                  </button>
                </div>
              </div>
            </div>
          </div>

          <section class="courses-section">
            <div *ngIf="filteredCourses.length > 0" class="courses-grid">
              <article *ngFor="let course of filteredCourses" class="course-card">
                <div class="course-header">
                  <img
                    [src]="getThumbnailUrl(course.thumbnailUrl)"
                    [alt]="course.courseName"
                    class="course-thumbnail"
                  />
                  <div class="course-header-details">
                    <h3 class="course-title">{{ course.courseName }}</h3>
                    <div class="course-tags">
                      <span class="category-chip">{{ course.category || 'General' }}</span>
                      <span class="difficulty-chip" *ngIf="course.difficultyLevel">
                        {{ course.difficultyLevel }}
                      </span>
                    </div>
                  </div>
                  <button type="button" class="view-button" (click)="navigateToCourse(course.courseId)">
                    View
                  </button>
                </div>

                <div class="course-meta">
                  <div class="meta-item">
                    <svg class="meta-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                    {{ course.totalModules || 0 }} modules
                  </div>
                  <div class="meta-item">
                    <svg class="meta-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    {{ formatDuration(course.totalDurationMinutes) }}
                  </div>
                </div>

                <div class="course-badges">
                  <span class="info-badge" [class.warning]="course.daysRemaining && course.daysRemaining < 30">
                    <span class="icon">üîë</span>
                    <span class="text" *ngIf="course.hasLifetimeAccess">Lifetime Access</span>
                    <span class="text" *ngIf="!course.hasLifetimeAccess && course.daysRemaining">
                      {{ course.daysRemaining }} days left
                    </span>
                    <span class="text" *ngIf="!course.hasLifetimeAccess && !course.daysRemaining">
                      Limited access
                    </span>
                  </span>
                  <span class="info-badge">
                    <span class="icon">üìù</span>
                    <span class="text">
                      {{ course.completedLessons || 0 }}/{{ course.totalLessons || 0 }} Lessons
                    </span>
                  </span>
                  <span class="info-badge">
                    <span class="icon">‚úÖ</span>
                    <span class="text">
                      {{ course.completedQuizzes || 0 }}/{{ course.totalQuizzes || 0 }} Quizzes
                    </span>
                  </span>
                </div>

                <div class="progress-section">
                  <p class="progress-summary">
                    {{ course.progressPercentage || 0 }}% complete
                    <span *ngIf="course.currentLesson">‚Ä¢ Lesson {{ course.currentLesson }}</span>
                  </p>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="course.progressPercentage || 0"></div>
                  </div>
                </div>

                <div class="course-actions">
                  <button type="button" class="outline-button" (click)="navigateToCourse(course.courseId)">
                    <svg class="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                      ></path>
                    </svg>
                    <span>Syllabus</span>
                  </button>
                  <button type="button" class="primary-button" (click)="resumeCourse(course)">
                    <svg class="button-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M14.752 11.168L19.5 14.135 14.752 17.102M12 6v6m0 0v6m0-6H6m6 0h6"
                      ></path>
                    </svg>
                    <span *ngIf="course.progressPercentage === 0">Start</span>
                    <span *ngIf="course.progressPercentage > 0 && course.progressPercentage < 100">Resume</span>
                    <span *ngIf="course.progressPercentage === 100">Review</span>
                  </button>
                </div>
              </article>
            </div>

            <div *ngIf="filteredCourses.length === 0" class="empty-state">
              <div class="empty-icon">üì≠</div>
              <h3>No courses found</h3>
              <p *ngIf="searchQuery || filterStatus !== 'all'">Try adjusting your search or filters.</p>
              <p *ngIf="!searchQuery && filterStatus === 'all'">Start learning by enrolling in a course!</p>
              <button
                *ngIf="!searchQuery && filterStatus === 'all'"
                type="button"
                class="primary-button"
                (click)="browseCourses()"
              >
                Browse Courses
              </button>
            </div>
          </section>
        </section>

        <aside class="sidebar">
          <section class="sidebar-card streak-card" *ngIf="stats">
            <h2 class="sidebar-title">Today's streak</h2>
            <div class="streak-meta">
              <div class="streak-icon">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5-2-4m1.5 5.5s1.5 1.5 2 1.5c1-1 3-3 0-5.5-2.5-3-4-2-4-2s-1.5 0-2.5 1c-1 1-2 3.5 0 5-1.5 1.5-3 2-3 2v4c0 1 1 2 2 2h2c1 0 2-1 2-2s-.5-2-2-3l1.5-1.5S17 17 17.657 18.657z"
                  ></path>
                </svg>
              </div>
              <p class="streak-value">{{ stats.currentStreak || 0 }} days</p>
            </div>
            <p class="sidebar-caption">Keep it up! Complete a lesson to extend your streak.</p>
          </section>

          <section class="sidebar-card continue-card" *ngIf="topContinueLearning.length > 0">
            <h2 class="sidebar-title">Continue lessons</h2>
            <div class="lesson-item" *ngFor="let lesson of topContinueLearning">
              <img
                [src]="getThumbnailUrl(lesson.thumbnailUrl)"
                [alt]="lesson.courseName"
                class="lesson-thumb"
              />
              <div class="lesson-info">
                <p class="lesson-title">{{ lesson.currentLesson || lesson.courseName }}</p>
                <p class="lesson-meta">{{ lesson.courseName }} ‚Ä¢ {{ formatDuration(lesson.totalDurationMinutes) }}</p>
              </div>
              <button type="button" class="pill-button" (click)="resumeCourse(lesson)">Resume</button>
            </div>
          </section>

          <section class="sidebar-card certificates-card" *ngIf="completedCoursesList.length > 0">
            <h2 class="sidebar-title">Certificates</h2>
            <div class="certificate-item" *ngFor="let course of completedCoursesList">
              <div class="certificate-icon">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.24a1 1 0 010 1.414l-8.293 8.293a1 1 0 01-1.414 0l-3.293-3.293a1 1 0 010-1.414l8.293-8.293a1 1 0 011.414 0l3.293 3.293z"></path>
                </svg>
              </div>
              <div class="certificate-info">
                <p class="certificate-title">{{ course.courseName }}</p>
                <p class="certificate-meta">Completed {{ formatDate(course.lastAccessedDate || course.enrolledDate) }}</p>
              </div>
              <button type="button" class="pill-button" (click)="navigateToCourse(course.courseId)">
                View
              </button>
            </div>
          </section>
        </aside>
      </div>
    </div>
  </div>
